---
title: "solarModel"
author: "Beniamino Sartini"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE,
  collapse = TRUE,
  comment = "#>"
)
library(solarr)
library(ggplot2)
```

# Control 

```{r}
control_model <- control_solarModel(outliers_quantile = 0)
```

# Fit

```{r}
spec <- solarModel_spec("Ferrara", from="2005-01-01", to="2022-01-01", control_model = control_model)
model <- solarModel(spec)
```

# Simulation 

```{r}
scenario <- solarModel_scenario(model, nsim = 1, by = "1 day")
sim <- tidyr::unnest(scenario$sim, cols = "data")
ggplot()+
  geom_line(data = sim, aes(n, GHI), color = "red")+
  geom_line(data = scenario$emp, aes(n, GHI))+
  theme_bw()
```

# Parameters

```{r}
solarModel_parameters(model, as_tibble = T) %>%
  tidyr::gather("parameter", "value")
```

# Log-likelihood

```{r}
purrr::map_dbl(1:12, ~solarModel_loglik(model, nmonths = .x)$log_lik)
```

